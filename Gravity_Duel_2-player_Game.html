<!DOCTYPE html>
<html>
<head>
<title>Gravity Duel</title>
<style>
body{
  margin:0;
  background:#0a0a12;
  color:#eee;
  font-family:Segoe UI, sans-serif;
  text-align:center;
}
#ui{
  padding:10px;
  background:#111;
}
canvas{
  display:block;
  margin:auto;
  background:#000;
}
</style>
<style>
  /* Instructions UI (added) */
  #rulesBtn{position:fixed;top:10px;right:12px;z-index:40;padding:8px 12px;border-radius:8px;border:none;background:#38bdf8;color:#fff;font-family:monospace;font-weight:700;cursor:pointer}
  #rulesBox{position:fixed;top:52px;right:12px;width:320px;background:rgba(0,0,0,0.85);color:#fff;padding:12px;border-radius:10px;display:none;font-family:monospace;font-size:14px;z-index:40}
</style>
  <meta name="viewport" content="width=device-width,initial-scale=1">
</head>
<body>
<a class="home-link" href="Home.html">üè† Home</a>

<div id="ui">
Blue: <span id="blueScore">0</span> |
Red: <span id="redScore">0</span>
</div>

<canvas id="game" width="1000" height="600"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

const keys={};
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

let blueScore=0;
let redScore=0;
let round=1;

function createPlayer(x,y,color){
  return{
    x,y,
    vx:0,
    vy:0,
    angle:0,
    color,
    bullets:[],
    energy:100,
    radius:18,
    health:100
  };
}

let p1=createPlayer(300,300,"#3498db");
let p2=createPlayer(700,300,"#e74c3c");

let asteroids=[];

function spawnAsteroids(){
  asteroids=[];
  for(let i=0;i<round+2;i++){
    asteroids.push({
      x:Math.random()*canvas.width,
      y:Math.random()*canvas.height,
      vx:(Math.random()-0.5)*(1+round*0.2),
      vy:(Math.random()-0.5)*(1+round*0.2),
      r:20+Math.random()*20
    });
  }
}
spawnAsteroids();

/* ---------- Movement ---------- */
function handleControls(p, thrustKey, leftKey, rightKey, shootKey){
  if(keys[leftKey]) p.angle-=0.05;
  if(keys[rightKey]) p.angle+=0.05;

  if(keys[thrustKey] && p.energy>0){
    p.vx+=Math.cos(p.angle)*0.15;
    p.vy+=Math.sin(p.angle)*0.15;
    p.energy-=0.5;
  }else{
    p.energy=Math.min(100,p.energy+0.2);
  }

  if(keys[shootKey]){
    shoot(p);
    keys[shootKey]=false;
  }
}

/* ---------- Shooting ---------- */
function shoot(p){
  p.bullets.push({
    x:p.x,
    y:p.y,
    vx:Math.cos(p.angle)*6,
    vy:Math.sin(p.angle)*6
  });

  // recoil
  p.vx-=Math.cos(p.angle)*0.4;
  p.vy-=Math.sin(p.angle)*0.4;
}

/* ---------- Physics ---------- */
function updatePlayer(p){
  p.x+=p.vx;
  p.y+=p.vy;

  // wrap around
  if(p.x<0) p.x=canvas.width;
  if(p.x>canvas.width) p.x=0;
  if(p.y<0) p.y=canvas.height;
  if(p.y>canvas.height) p.y=0;

  p.vx*=0.99;
  p.vy*=0.99;
}

function drawPlayer(p){
  ctx.save();
  ctx.translate(p.x,p.y);
  ctx.rotate(p.angle);

  ctx.strokeStyle=p.color;
  ctx.lineWidth=2;

  ctx.beginPath();
  ctx.moveTo(20,0);
  ctx.lineTo(-15,12);
  ctx.lineTo(-10,0);
  ctx.lineTo(-15,-12);
  ctx.closePath();
  ctx.stroke();

  ctx.restore();

  // health
  ctx.fillStyle="lime";
  ctx.fillRect(p.x-20,p.y-30,40*(p.health/100),4);

  // energy
  ctx.fillStyle="cyan";
  ctx.fillRect(p.x-20,p.y-35,40*(p.energy/100),3);
}

/* ---------- Bullets ---------- */
function updateBullets(p, opponent){
  p.bullets.forEach((b,i)=>{
    b.x+=b.vx;
    b.y+=b.vy;

    ctx.fillStyle="#fff";
    ctx.fillRect(b.x,b.y,4,4);

    if(Math.hypot(b.x-opponent.x,b.y-opponent.y)<opponent.radius){
      opponent.health-=10;
      p.bullets.splice(i,1);
    }

    if(b.x<0||b.x>canvas.width||b.y<0||b.y>canvas.height)
      p.bullets.splice(i,1);
  });
}

/* ---------- Asteroids ---------- */
function updateAsteroids(){
  asteroids.forEach(a=>{
    a.x+=a.vx;
    a.y+=a.vy;

    if(a.x<0||a.x>canvas.width) a.vx*=-1;
    if(a.y<0||a.y>canvas.height) a.vy*=-1;

    ctx.strokeStyle="#555";
    ctx.beginPath();
    ctx.arc(a.x,a.y,a.r,0,Math.PI*2);
    ctx.stroke();

    [p1,p2].forEach(p=>{
      if(Math.hypot(p.x-a.x,p.y-a.y)<a.r+p.radius){
        p.health-=0.5;
      }
    });
  });
}

/* ---------- Round Reset ---------- */
function checkWin(){
  if(p1.health<=0){
    redScore++;
    document.getElementById("redScore").innerText=redScore;
    nextRound();
  }
  if(p2.health<=0){
    blueScore++;
    document.getElementById("blueScore").innerText=blueScore;
    nextRound();
  }
}

function nextRound(){
  round++;
  p1=createPlayer(300,300,"#3498db");
  p2=createPlayer(700,300,"#e74c3c");
  spawnAsteroids();
}

/* ---------- Game Loop ---------- */
function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  handleControls(p1,"w","a","d","f");
  handleControls(p2,"ArrowUp","ArrowLeft","ArrowRight","/");

  updatePlayer(p1);
  updatePlayer(p2);

  drawPlayer(p1);
  drawPlayer(p2);

  updateBullets(p1,p2);
  updateBullets(p2,p1);

  updateAsteroids();

  checkWin();

  requestAnimationFrame(update);
}

update();
</script>
<button id="rulesBtn">üìú INSTRUCTIONS</button>
<div id="rulesBox">
  <b>üìú GAME INSTRUCTIONS</b><br><br>
  Two-player gravity duel ‚Äî use controls to move and manipulate gravity to defeat your opponent.<br>
</div>

<script>
  const rulesBtn = document.getElementById('rulesBtn');
  const rulesBox = document.getElementById('rulesBox');
  if (rulesBtn && rulesBox) rulesBtn.onclick = () => { rulesBox.style.display = rulesBox.style.display === 'block' ? 'none' : 'block'; };
</script>
<script src="global-touch.js"></script>
</body>
</html>

