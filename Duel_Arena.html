<!DOCTYPE html>
<html>
<head>
<title>Duel Arena Evolution</title>
<style>
body{
  margin:0;
  background:#0f0f14;
  color:#eee;
  font-family:Segoe UI, sans-serif;
  text-align:center;
}
#ui{
  padding:10px;
  background:#15151c;
  border-bottom:1px solid #333;
}
canvas{
  display:block;
  margin:auto;
  background:#1b1b24;
}
</style>
<style>
  /* Instructions UI (added) */
  #rulesBtn{position:fixed;top:10px;right:12px;z-index:40;padding:8px 12px;border-radius:8px;border:none;background:#38bdf8;color:#fff;font-family:monospace;font-weight:700;cursor:pointer}
  #rulesBox{position:fixed;top:52px;right:12px;width:320px;background:rgba(0,0,0,0.85);color:#fff;padding:12px;border-radius:10px;display:none;font-family:monospace;font-size:14px;z-index:40}
</style>
</head>
<body>
<a class="home-link" href="Home.html">üè† Home</a>

<div id="ui">
Level: <span id="level">1</span> |
Blue: <span id="blueScore">0</span> |
Red: <span id="redScore">0</span>
</div>

<canvas id="game" width="1100" height="600"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

let level=1;
let winTarget=3;
let blueWins=0;
let redWins=0;

let gravity=0.6;
let windForce=0;
let darkness=false;
let suddenDeath=false;

const ground=550;
const keys={};
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

function createPlayer(x,color){
  return{
    x:x,
    y:ground,
    w:40,
    h:80,
    dy:0,
    speed:5,
    jump:-20,
    color:color,
    bullets:[],
    facing:1,
    health:100,
    muzzle:0,
    jumps:0,
    dashCooldown:0,
    weaponLevel:1
  };
}

let p1=createPlayer(200,"#3498db");
let p2=createPlayer(900,"#e74c3c");

let platforms=[];
let spikes=[];
let boss=null;

/* -------- Arena Generation -------- */
function generateArena(){
  platforms=[];
  spikes=[];
  boss=null;

  windForce = level>3 ? (Math.random()*0.4 - 0.2) : 0;
  darkness = level>4 && Math.random()<0.5;
  suddenDeath = level>6 && Math.random()<0.3;

  for(let i=0;i<Math.min(4+level/2,8);i++){
    platforms.push({
      x:Math.random()*900+50,
      y:Math.random()*350+150,
      w:120+Math.random()*200
    });
  }

  if(level>3){
    spikes.push({
      x:Math.random()*900+50,
      w:200
    });
  }

  if(level%10===0){
    boss={
      x:550,
      y:ground,
      health:300+level*20
    };
  }
}

generateArena();

/* -------- Movement -------- */
function handleMovement(p, left, right, jumpKey, shootKey, dashKey){

  if(keys[left]){ p.x-=p.speed; p.facing=-1; }
  if(keys[right]){ p.x+=p.speed; p.facing=1; }

  if(keys[jumpKey] && p.jumps<2){
    p.dy=p.jump;
    p.jumps++;
  }

  if(keys[dashKey] && p.dashCooldown<=0){
    p.x+=p.facing*120;
    p.dashCooldown=60;
  }

  if(keys[shootKey]){
    if(p.bullets.length<2+p.weaponLevel){
      shoot(p);
    }
    keys[shootKey]=false;
  }

  if(p.dashCooldown>0) p.dashCooldown--;
}

/* -------- Shooting -------- */
function shoot(p){
  p.bullets.push({
    x:p.x+20,
    y:p.y-60,
    dx:p.facing*(8+level+p.weaponLevel)
  });
  p.muzzle=5;
}

/* -------- Physics -------- */
function applyPhysics(p){
  p.dy+=gravity;
  p.y+=p.dy;
  p.x+=windForce*5;

  if(p.y>ground){
    p.y=ground;
    p.dy=0;
    p.jumps=0;
  }

  platforms.forEach(pl=>{
    if(p.x+40>pl.x && p.x<pl.x+pl.w &&
       p.y>pl.y && p.y<pl.y+20 && p.dy>=0){
      p.y=pl.y;
      p.dy=0;
      p.jumps=0;
    }
  });

  spikes.forEach(s=>{
    if(p.y>=ground && p.x>s.x && p.x<s.x+s.w){
      p.health-=0.8+level*0.1;
    }
  });

  if(suddenDeath) p.health-=0.05;
}

/* -------- Bullets -------- */
function handleBullets(shooter,target){
  shooter.bullets.forEach((b,i)=>{
    b.x+=b.dx;
    ctx.fillStyle="#fff";
    ctx.fillRect(b.x,b.y,8,4);

    if(b.x>target.x && b.x<target.x+40 &&
       b.y>target.y-80 && b.y<target.y){
      target.health-=15+level;
      shooter.bullets.splice(i,1);
    }

    if(b.x<0||b.x>canvas.width)
      shooter.bullets.splice(i,1);
  });

  if(target.health<=0){
    if(target===p1) redWins++;
    else blueWins++;

    if(blueWins>=winTarget || redWins>=winTarget){
      nextLevel();
    }else{
      resetRound();
    }
  }
}

/* -------- Boss -------- */
function updateBoss(){
  if(!boss) return;

  ctx.fillStyle="#8e44ad";
  ctx.fillRect(boss.x-30,boss.y-80,60,80);

  ctx.fillStyle="purple";
  ctx.fillRect(boss.x-50,boss.y-100,boss.health/5,8);

  if(Math.random()<0.02){
    if(Math.random()<0.5) p1.health-=5;
    else p2.health-=5;
  }

  if(boss.health<=0){
    p1.weaponLevel++;
    p2.weaponLevel++;
    boss=null;
  }
}

/* -------- Drawing -------- */
function drawArena(){
  ctx.fillStyle="#222";
  ctx.fillRect(0,ground+30,canvas.width,50);

  spikes.forEach(s=>{
    ctx.fillStyle="#aa0000";
    ctx.fillRect(s.x,ground+30,s.w,50);
  });

  ctx.fillStyle="#333";
  platforms.forEach(pl=>{
    ctx.fillRect(pl.x,pl.y,pl.w,20);
  });
}

function drawPlayer(p){
  ctx.fillStyle=p.color;
  ctx.fillRect(p.x,p.y-60,40,60);

  ctx.beginPath();
  ctx.arc(p.x+20,p.y-80,20,0,Math.PI*2);
  ctx.fill();

  ctx.fillStyle="#fff";
  ctx.beginPath();
  ctx.arc(p.x+14,p.y-85,4,0,Math.PI*2);
  ctx.arc(p.x+26,p.y-85,4,0,Math.PI*2);
  ctx.fill();

  ctx.save();
  ctx.translate(p.x+20,p.y-60);
  ctx.scale(p.facing,1);
  ctx.fillStyle="#444";
  ctx.fillRect(0,-5,40,10);
  if(p.muzzle>0){
    ctx.fillStyle="orange";
    ctx.fillRect(40,-5,12,10);
    p.muzzle--;
  }
  ctx.restore();

  ctx.fillStyle="lime";
  ctx.fillRect(p.x,p.y-100,40*(p.health/100),6);
}

/* -------- Reset & Level -------- */
function resetRound(){
  p1=createPlayer(200,"#3498db");
  p2=createPlayer(900,"#e74c3c");
}

function nextLevel(){
  level++;
  winTarget++;
  blueWins=0;
  redWins=0;
  document.getElementById("level").innerText=level;
  document.getElementById("blueScore").innerText=0;
  document.getElementById("redScore").innerText=0;
  generateArena();
  resetRound();
}

/* -------- Game Loop -------- */
function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(darkness){
    ctx.fillStyle="rgba(0,0,0,0.6)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }

  drawArena();

  handleMovement(p1,"a","d","w","f","Shift");
  handleMovement(p2,"ArrowLeft","ArrowRight","ArrowUp","/","Enter");

  applyPhysics(p1);
  applyPhysics(p2);

  drawPlayer(p1);
  drawPlayer(p2);

  handleBullets(p1,p2);
  handleBullets(p2,p1);

  updateBoss();

  requestAnimationFrame(update);
}

update();
</script>
<button id="rulesBtn">üìú INSTRUCTIONS</button>
<div id="rulesBox">
  <b>üìú GAME INSTRUCTIONS</b><br><br>
  Two-player arena ‚Äî use keyboard controls to move and attack.<br>
  Last player standing wins. Learn combos and use the arena to your advantage.<br>
</div>

<script>
  const rulesBtn = document.getElementById('rulesBtn');
  const rulesBox = document.getElementById('rulesBox');
  if (rulesBtn && rulesBox) rulesBtn.onclick = () => { rulesBox.style.display = rulesBox.style.display === 'block' ? 'none' : 'block'; };
</script>
</body>
</html>
