<!DOCTYPE html>
<html>
<head>
  <title>Mission Adventure</title>
  <style>
    body {
      margin: 0;
      background: #60a5fa;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: Arial;
    }
    canvas {
      background: linear-gradient(#93c5fd, #dcfce7);
      border: 6px solid #166534;
    }
  </style>
<style>
  /* Instructions UI (added) */
  #rulesBtn{position:fixed;top:10px;right:12px;z-index:40;padding:8px 12px;border-radius:8px;border:none;background:#38bdf8;color:#fff;font-family:monospace;font-weight:700;cursor:pointer}
  #rulesBox{position:fixed;top:52px;right:12px;width:320px;background:rgba(0,0,0,0.85);color:#fff;padding:12px;border-radius:10px;display:none;font-family:monospace;font-size:14px;z-index:40}
</style>
</head>

<body>
<a class="home-link" href="Home.html">üè† Home</a>
<canvas id="game" width="800" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* PLAYER */
let player = { x:40, y:300, w:26, h:44, velY:0, onGround:false };
let gravity = 0.8;
let lives = 3;
let level = 1;
let maxLevel = 4;
let win = false;
let safeUntil = 0;

/* TROPHIES */
let trophies = [false, false, false, false]; // levels 1-4

/* CONTROLS */
let keys = {};
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

/* LEVEL DATA */
let levelData = {
  1:{ enemies:["cat"], spikes:[{x:250},{x:280}] },
  2:{ enemies:["eagle"], spikes:[{x:300},{x:330},{x:360}] },
  3:{ enemies:["rhino"], spikes:[{x:400}] },
  4:{ enemies:["cat","eagle","rhino"], spikes:[{x:260},{x:290},{x:320},{x:350}] }
};

/* ENEMIES */
let cat = { x:200, y:300, dir:1 };
let eagle = { x:300, y:120, dir:1 };
let rhino = { x:450, y:300, dir:-1 };

/* GOAL */
let goal = { x:740, y:260, w:40, h:80 };

/* COLLISION */
function hit(px,py,pw,ph,ox,oy,ow,oh){
  return px<ox+ow && px+pw>ox && py<oy+oh && py+ph>oy;
}

/* LOAD LEVEL */
function loadLevel(){
  player.x = 40;
  cat.x = 200;
  eagle.x = 300;
  rhino.x = 450;
}

/* UPDATE */
function update(){
  if(win || lives<=0) return;

  if(keys["ArrowRight"]||keys["d"]||keys["D"]) player.x+=4;
  if(keys["ArrowLeft"]||keys["a"]||keys["A"]) player.x-=4;

  if((keys["ArrowUp"]||keys["w"]||keys["W"]||keys[" "]) && player.onGround){
    player.velY=-13; player.onGround=false;
  }

  player.velY+=gravity;
  player.y+=player.velY;

  if(player.y>300){ player.y=300; player.velY=0; player.onGround=true; }

  let enemies = levelData[level].enemies;

  if(enemies.includes("cat")){
    cat.x+=cat.dir*2;
    if(cat.x<150||cat.x>300) cat.dir*=-1;
    if(Date.now()>safeUntil && hit(player.x,player.y,player.w,player.h,cat.x,cat.y,40,22)){
      lives--; safeUntil=Date.now()+1000;
    }
  }

  if(enemies.includes("eagle")){
    eagle.x+=eagle.dir*3;
    eagle.y+=1.2;
    if(eagle.y>200) eagle.y=120;
    if(eagle.x<200||eagle.x>600) eagle.dir*=-1;
    if(Date.now()>safeUntil && hit(player.x,player.y,player.w,player.h,eagle.x,eagle.y,36,20)){
      lives--; safeUntil=Date.now()+1000;
    }
  }

  if(enemies.includes("rhino")){
    rhino.x+=rhino.dir*5;
    if(rhino.x<350||rhino.x>600) rhino.dir*=-1;
    if(Date.now()>safeUntil && hit(player.x,player.y,player.w,player.h,rhino.x,rhino.y,65,32)){
      lives--; safeUntil=Date.now()+1000;
    }
  }

  levelData[level].spikes.forEach(s=>{
    if(Date.now()>safeUntil && hit(player.x,player.y,player.w,player.h,s.x,340,22,22)){
      lives--; safeUntil=Date.now()+1000;
    }
  });

  if(hit(player.x,player.y,player.w,player.h,goal.x,goal.y,goal.w,goal.h)){
    trophies[level-1] = true;   // ?? EARN TROPHY
    level++;
    if(level>maxLevel){
      win=true;
    } else {
      loadLevel();
    }
  }
}

/* DRAW PLAYER */
function drawPlayer(){
  ctx.fillStyle="#fcd7b6";
  ctx.beginPath(); ctx.arc(player.x+13,player.y-10,9,0,Math.PI*2); ctx.fill();
  ctx.fillStyle="#2563eb";
  ctx.fillRect(player.x+6,player.y,14,22);
  ctx.fillStyle="#1f2937";
  ctx.fillRect(player.x+6,player.y+22,6,18);
  ctx.fillRect(player.x+14,player.y+22,6,18);
}

/* DRAW TROPHIES */
function drawTrophies(){
  let colors = ["#cd7f32","#c0c0c0","#ffd700","#22c55e"];
  trophies.forEach((t,i)=>{
    if(t){
      ctx.fillStyle = colors[i];
      ctx.beginPath();
      ctx.arc(760 - i*22, 25, 8, 0, Math.PI*2);
      ctx.fill();
    }
  });
}

/* DRAW */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="#15803d";
  ctx.fillRect(0,340,800,60);

  drawPlayer();
  drawTrophies();

  let enemies = levelData[level].enemies;

  if(enemies.includes("cat")){
    ctx.fillStyle="#f97316";
    ctx.beginPath();
    ctx.ellipse(cat.x+20,cat.y+18,18,10,0,0,Math.PI*2);
    ctx.fill();
  }

  if(enemies.includes("eagle")){
    ctx.fillStyle="#7c2d12";
    ctx.beginPath();
    ctx.moveTo(eagle.x,eagle.y+10);
    ctx.lineTo(eagle.x+18,eagle.y);
    ctx.lineTo(eagle.x+36,eagle.y+10);
    ctx.fill();
  }

  if(enemies.includes("rhino")){
    ctx.fillStyle="#6b7280";
    ctx.beginPath();
    ctx.ellipse(rhino.x+32,rhino.y+20,30,16,0,0,Math.PI*2);
    ctx.fill();
  }

  ctx.fillStyle="#1f2937";
  levelData[level].spikes.forEach(s=>{
    ctx.beginPath();
    ctx.moveTo(s.x,340);
    ctx.lineTo(s.x+11,320);
    ctx.lineTo(s.x+22,340);
    ctx.fill();
  });

  ctx.fillStyle="#22c55e";
  ctx.fillRect(goal.x,goal.y,goal.w,goal.h);

  ctx.fillStyle="black";
  ctx.font="16px Arial";
  ctx.fillText("?? Lives: "+lives,10,20);
  ctx.fillText("Level: "+level,10,40);

  if(win){
    ctx.fillStyle="rgba(0,0,0,0.7)";
    ctx.fillRect(0,0,800,400);
    ctx.fillStyle="white";
    ctx.font="32px Arial";
    ctx.fillText("ALL TROPHIES WON! ??",250,200);
  }

  if(lives<=0){
    ctx.fillStyle="rgba(0,0,0,0.7)";
    ctx.fillRect(0,0,800,400);
    ctx.fillStyle="white";
    ctx.font="32px Arial";
    ctx.fillText("GAME OVER",330,200);
  }
}

/* LOOP */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loadLevel();
loop();
</script>
<button id="rulesBtn">üìú INSTRUCTIONS</button>
<div id="rulesBox">
  <b>üìú GAME INSTRUCTIONS</b><br><br>
  Explore the map, collect items and solve puzzles to progress through missions.<br>
</div>

<script>
  const rulesBtn = document.getElementById('rulesBtn');
  const rulesBox = document.getElementById('rulesBox');
  if (rulesBtn && rulesBox) rulesBtn.onclick = () => { rulesBox.style.display = rulesBox.style.display === 'block' ? 'none' : 'block'; };
</script>
</body>
</html>
